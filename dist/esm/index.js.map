{"version":3,"file":"index.js","sources":["../../src/invariant.js","../../src/index.js"],"sourcesContent":["/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\n/**\n * Use invariant() to assert state which your program assumes to be true.\n *\n * Provide sprintf-style format (only %s is supported) and arguments\n * to provide information about what broke and what you were\n * expecting.\n *\n * The invariant message will be stripped in production, but the invariant\n * will remain to ensure logic does not differ in production.\n */\n\nvar NODE_ENV = process.env.NODE_ENV;\n\nvar invariant = function(condition, format, a, b, c, d, e, f) {\n  if (NODE_ENV !== 'production') {\n    if (format === undefined) {\n      throw new Error('invariant requires an error message argument');\n    }\n  }\n\n  if (!condition) {\n    var error;\n    if (format === undefined) {\n      error = new Error(\n        'Minified exception occurred; use the non-minified dev environment ' +\n        'for the full error message and additional helpful warnings.'\n      );\n    } else {\n      var args = [a, b, c, d, e, f];\n      var argIndex = 0;\n      error = new Error(\n        format.replace(/%s/g, function() { return args[argIndex++]; })\n      );\n      error.name = 'Invariant Violation';\n    }\n\n    error.framesToPop = 1; // we don't care about invariant's own frame\n    throw error;\n  }\n};\n\nexport default invariant\n","import invariant from \"./invariant.js\";\n\nconst START = 0;\nconst DATA = 1;\nconst ERROR = 2;\nconst CANCEL = 3;\n\nconst invariantStart = (start) =>\n  invariant(start === 0, \"sources and operators can only be started\");\n\nexport const pipe = (...cbs) => {\n  let res = cbs[0];\n  for (let i = 1, n = cbs.length; i < n; i++) res = cbs[i](res);\n  return res;\n};\n\nexport const rejected = (e) => (start, sink) => {\n  invariantStart(start);\n  sink(ERROR, e);\n};\n\nexport const resolved = (a) => (start, sink) => {\n  invariantStart(start);\n  sink(DATA, a);\n};\n\nexport const make = (f) => (start, sink) => {\n  invariantStart(start);\n  const onResolve = (a) => sink(DATA, a);\n  const onReject = (e) => sink(ERROR, e);\n  let cleanup = f(onReject, onResolve);\n  sink(START, (t, d) => {\n    if (t === CANCEL && cleanup) cleanup();\n  });\n};\n\nexport const flatMapError = (f) => (source) => (start, sink) => {\n  invariantStart(start);\n  source(START, (t, d) => {\n    t === ERROR ? f(d)(START, sink) : sink(t, d);\n  });\n};\n\nexport const mapError = (f) => (source) => (start, sink) => {\n  invariantStart(start);\n  source(START, (t, d) => {\n    sink(t, t === ERROR ? f(d) : d);\n  });\n};\n\nexport const flatMap = (f) => (source) => (start, sink) => {\n  invariantStart(start);\n  source(START, (t, d) => {\n    t === DATA ? f(d)(START, sink) : sink(t, d);\n  });\n};\n\nexport const map = (f) => (source) => (start, sink) => {\n  invariantStart(start);\n  source(START, (t, d) => {\n    sink(t, t === DATA ? f(d) : d);\n  });\n};\n\nexport const andMap = (sourceA) => (sourceF) => (start, sink) => {\n  invariantStart(start);\n\n  let tf, df, ta, da;\n\n  const tryAll = () => {\n    if (tf === DATA && ta === DATA) return sink(DATA, df(da));\n    if (tf === ERROR && ta) return sink(ERROR, df);\n    if (ta === ERROR && tf) return sink(ERROR, da);\n  };\n\n  sourceF(START, (t, d) => {\n    if (t === START) sink(t, d);\n    if (t === DATA || t === ERROR) {\n      tf = t;\n      df = d;\n      tryAll();\n    }\n  });\n\n  sourceA(START, (t, d) => {\n    if (t === START) sink(t, d);\n    if (t === DATA || t === ERROR) {\n      ta = t;\n      da = d;\n      tryAll();\n    }\n  });\n};\n\nexport const fork = (onReject, onResolve) => (source) => {\n  let talkback;\n  source(START, (t, d) => {\n    if (t === START) talkback = d;\n    if (t === DATA) onResolve(d);\n    if (t === ERROR) onReject(d);\n  });\n  return () => {\n    talkback(CANCEL);\n  };\n};\n"],"names":[],"mappings":"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"}